<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NicoBierchen üç∫</title>

  <style>
    :root{
      --bg1:#0b0b10;
      --bg2:#151528;
      --beer:#ffb000;
      --beer2:#ffcf4a;
      --foam:#fff7e6;
      --text:#f6f7ff;
      --muted:#b9bbd6;
      --ok:#88ffb3;
      --mid:#ffd36b;
      --hard:#ff7b7b;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 20%, #2a2a55 0%, transparent 60%),
        radial-gradient(900px 500px at 80% 70%, #3a2a10 0%, transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* NAVBAR */
    nav{
      position:sticky;
      top:0;
      z-index:1000;
      backdrop-filter: blur(12px);
      background:#0b0b10cc;
      border-bottom:1px solid #ffffff1a;
    }
    .nav-inner{
      max-width:1100px;
      margin:auto;
      padding:12px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
    }
    .logo{
      font-weight:900;
      letter-spacing:.4px;
      color:var(--beer2);
      user-select:none;
      white-space:nowrap;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .logo:hover{ filter: drop-shadow(0 0 10px #ffb00066); }

    /* Desktop links */
    .nav-links{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .nav-links a, .mobile-links a{
      color:var(--muted);
      text-decoration:none;
      font-weight:800;
      padding:10px 12px;
      border-radius:12px;
      transition:.15s;
      display:inline-block;
    }
    .nav-links a:hover, .mobile-links a:hover{
      color:#1b1200;
      background:linear-gradient(180deg, var(--beer2), var(--beer));
      box-shadow:0 10px 26px #ffb00055;
    }

    /* Burger Button (nur mobile sichtbar) */
    .burger{
      display:none;
      border:1px solid #ffffff1a;
      background:#ffffff10;
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
    }

    /* Mobile dropdown */
    .mobile-menu{
      display:none;
      border-top:1px solid #ffffff1a;
      padding:10px 18px 14px;
    }
    .mobile-links{
      display:grid;
      gap:8px;
      max-width:1100px;
      margin:0 auto;
    }
    .mobile-open .mobile-menu{ display:block; }

    section{
      max-width:1100px;
      margin:auto;
      padding:88px 18px;
    }
    h1{font-size:clamp(34px, 5vw, 64px); margin:0 0 10px;}
    h2{font-size:clamp(26px, 4vw, 42px); margin:0 0 12px;}
    p{color:var(--muted); font-size:18px; max-width:70ch; margin:0 0 16px;}

    .card{
      background:#ffffff10;
      border:1px solid #ffffff1a;
      border-radius:22px;
      padding:28px;
      box-shadow:0 20px 60px #00000066;
      backdrop-filter: blur(10px);
    }

    .hero{
      display:grid;
      grid-template-columns:1.1fr .9fr;
      gap:30px;
      align-items:center;
    }

    /* Deko Bierglas */
    .glass{
      width:280px;
      height:380px;
      margin:auto;
      border-radius:24px 24px 36px 36px;
      background:#ffffff12;
      border:1px solid #ffffff2a;
      position:relative;
      overflow:hidden;
      box-shadow: inset 0 0 0 2px #ffffff08, 0 30px 80px #00000066;
      transform: translateZ(0);
    }
    .glass::after{
      content:"";
      position:absolute;
      right:-34px; top:120px;
      width:84px; height:150px;
      border-radius:80px;
      border:14px solid #ffffff22;
      box-shadow: inset 0 0 0 3px #ffffff10;
    }
    .beer{
      position:absolute;
      left:12px; right:12px; bottom:12px;
      height:60%;
      background:linear-gradient(180deg,#ffdf6a,#ffb000,#ff8c00);
      border-radius:0 0 28px 28px;
      animation:slosh 3.2s ease-in-out infinite;
    }
    @keyframes slosh{
      0%,100%{transform:rotate(-1deg) translateX(-2px)}
      50%{transform:rotate(1deg) translateX(2px)}
    }
    .foam{
      position:absolute;
      top:35%;
      left:10px; right:10px;
      height:60px;
      background: radial-gradient(circle at 20% 60%, #fff7e6 0 32px, transparent 33px),
                  radial-gradient(circle at 45% 50%, #fff7e6 0 36px, transparent 37px),
                  radial-gradient(circle at 70% 55%, #fff7e6 0 34px, transparent 35px),
                  linear-gradient(180deg, #fff7e6, #fff0c8);
      border-radius:18px;
      animation:foam 2.5s ease-in-out infinite;
      filter: drop-shadow(0 12px 18px #ffffff1a);
    }
    @keyframes foam{
      0%,100%{transform:translateY(0)}
      50%{transform:translateY(-6px)}
    }

    /* Buttons */
    .btn{
      border:none;
      cursor:pointer;
      border-radius:14px;
      padding:12px 14px;
      font-weight:900;
      color:#1b1200;
      background:linear-gradient(180deg, var(--beer2), var(--beer));
      box-shadow:0 12px 30px #ffb00033;
      transition: transform .12s ease, filter .12s ease;
    }
    .btn:hover{transform:translateY(-2px); filter:saturate(1.1);}
    .btn:active{transform:translateY(0) scale(.99);}

    .btn-ghost{
      background:#ffffff10;
      color:var(--text);
      border:1px solid #ffffff1a;
      box-shadow:none;
      font-weight:800;
    }

    /* Mode Auswahl */
    .mode-row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin: 14px 0 18px;
    }
    .mode{
      cursor:pointer;
      user-select:none;
      padding:12px 14px;
      border-radius:16px;
      background:#ffffff0f;
      border:1px solid #ffffff1a;
      transition:.18s;
      min-width: 220px;
      flex: 1 1 220px;
    }
    .mode:hover{transform:translateY(-3px); box-shadow:0 14px 32px #00000055;}
    .mode.active{
      border-color:#ffb00088;
      box-shadow: 0 0 0 2px #ffb00044, 0 18px 40px #00000066;
      background: linear-gradient(180deg, #ffffff14, #ffffff0a);
    }
    .mode-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-weight:900;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      letter-spacing:.2px;
      border:1px solid #ffffff22;
      background:#ffffff0f;
      color:var(--muted);
      white-space:nowrap;
    }
    .badge.easy{ color:var(--ok); border-color:#88ffb355; }
    .badge.mid{ color:var(--mid); border-color:#ffd36b55; }
    .badge.hard{ color:var(--hard); border-color:#ff7b7b55; }

    /* HUD + Arena */
    .game-wrap{ display:grid; gap:14px; }
    .hud{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border-radius:18px;
      background:#ffffff10;
      border:1px solid #ffffff1a;
    }
    .hud .left{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      flex: 1 1 380px;
    }
    .hud .right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      flex: 1 1 240px;
    }
    .pill{
      padding:8px 12px;
      border-radius:999px;
      background:#ffffff0f;
      border:1px solid #ffffff1a;
      color:var(--muted);
      font-weight:800;
    }
    .pill b{ color:var(--text); }

    .arena{
      height: 420px;
      border-radius:22px;
      background: linear-gradient(180deg, #ffffff10, #ffffff06);
      border:1px solid #ffffff1a;
      box-shadow:0 22px 60px #00000066;
      position:relative;
      overflow:hidden;
      touch-action:none;
    }

    .nico{
      position:absolute;
      top:12px;
      left:16px;
      right:16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      color:var(--muted);
      font-weight:900;
      z-index:5;
      pointer-events:none;
      gap:12px;
    }
    .nico-fig{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 210px;
    }
    .nico-avatar{
      width:44px;
      height:44px;
      border-radius:16px;
      background: linear-gradient(180deg, #ffffff1a, #ffffff0a);
      border:1px solid #ffffff22;
      box-shadow: inset 0 0 0 2px #ffffff08, 0 12px 30px #00000055;
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .nico-avatar::before{
      content:"";
      position:absolute;
      left:10px; top:12px;
      width:24px; height:24px;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #ffffff66, #ffffff1a 65%, transparent 70%);
      opacity:.85;
    }
    .nico-name{
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }
    .nico-name small{ opacity:.75; font-weight:800; }
    .nico-throw{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-left:10px;
      padding:6px 10px;
      border-radius:999px;
      background:#ffffff0f;
      border:1px solid #ffffff1a;
    }
    .nico-arm{ display:inline-block; transform-origin:left center; }
    .nico-arm.throwing{ animation: throwArm .25s ease-out; }
    @keyframes throwArm{
      0%{ transform: rotate(0deg) translateX(0); }
      55%{ transform: rotate(-22deg) translateX(3px); }
      100%{ transform: rotate(0deg) translateX(0); }
    }

    .fall{
      position:absolute;
      top:-50px;
      width:36px;
      height:36px;
      border-radius:12px;
      display:grid;
      place-items:center;
      background:#ffffff12;
      border:1px solid #ffffff22;
      filter: drop-shadow(0 10px 18px #00000055);
      user-select:none;
      z-index:3;
    }
    .fall.good{ box-shadow:0 0 0 2px #ffb00033, 0 18px 34px #00000066; }
    .fall.fake{ box-shadow:0 0 0 2px #ff7b7b33, 0 18px 34px #00000066; }

    /* 3D-ish Catcher */
    .catcher{
      position:absolute;
      bottom:18px;
      left:50%;
      transform:translateX(-50%);
      width: 160px;
      height: 86px;
      border-radius: 18px 18px 30px 30px;
      background: linear-gradient(180deg, #ffffff20, #ffffff08);
      border:1px solid #ffffff2a;
      box-shadow: inset 0 0 0 2px #ffffff08, 0 18px 40px #00000066;
      display:grid;
      place-items:center;
      overflow:hidden;
      z-index:6;
    }
    .catcher::before{
      content:"";
      position:absolute;
      top:8px; left:10px; right:10px;
      height:10px;
      border-radius:999px;
      background: linear-gradient(90deg, #ffffff22, #ffffff55, #ffffff22);
      opacity:.85;
      box-shadow: 0 6px 20px #ffffff0f;
    }
    .catcher .fill{
      position:absolute;
      left:10px; right:10px; bottom:10px;
      height: 18px;
      border-radius: 0 0 22px 22px;
      background: linear-gradient(180deg, #ffdf6a, #ffb000, #ff8c00);
      box-shadow: inset 0 10px 20px #ffffff22;
      transform: skewX(-3deg);
      opacity:.92;
      transition: height .12s ease;
    }
    .catcher .foamline{
      position:absolute;
      left:12px; right:12px;
      bottom: calc(10px + 18px - 8px);
      height:14px;
      border-radius:999px;
      background: radial-gradient(circle at 20% 60%, #fff7e6 0 10px, transparent 11px),
                  radial-gradient(circle at 50% 50%, #fff7e6 0 12px, transparent 13px),
                  radial-gradient(circle at 80% 60%, #fff7e6 0 10px, transparent 11px),
                  linear-gradient(180deg, #fff7e6, #fff0c8);
      opacity:.9;
      filter: drop-shadow(0 6px 10px #ffffff12);
      transition: bottom .12s ease;
    }
    .catcher .shine{
      position:absolute;
      top:0; bottom:0;
      left:18px;
      width:20px;
      background: linear-gradient(180deg, transparent, #ffffff22, transparent);
      transform: rotate(10deg);
      opacity:.8;
    }
    .catcher .label{
      position:relative;
      z-index:7;
      opacity:.92;
      text-shadow: 0 8px 20px #00000088;
      font-size:13px;
      font-weight:900;
      letter-spacing:.2px;
      color:#f0f1ff;
    }

    .arena.wobble{
      transform-origin: center;
      animation: arenaWobble var(--wobbleSpeed, 0.55s) ease-in-out infinite;
      filter: saturate(1.05);
    }
    @keyframes arenaWobble{
      0%,100%{ transform: rotate(calc(var(--wobble, 0deg) * -1)) translateX(-2px); }
      50%{ transform: rotate(var(--wobble, 0deg)) translateX(2px); }
    }

    /* Funken */
    .spark{
      position:fixed;
      width:8px; height:8px;
      border-radius:50%;
      background: radial-gradient(circle, #ffd36b, #ffb000);
      pointer-events:none;
      mix-blend-mode: screen;
      animation: pop .9s ease-out forwards;
      z-index:9999;
    }
    @keyframes pop{
      from{ transform: translate(0,0) scale(1); opacity:1; }
      to{ transform: translate(var(--dx), var(--dy)) scale(0); opacity:0; }
    }

    footer{
      text-align:center;
      padding:40px 20px;
      color:#aaa;
      border-top:1px solid #ffffff1a;
    }

    /* ======= RESPONSIVE ======= */
    @media (max-width: 900px){
      .hero{ grid-template-columns: 1fr; }
    }

    @media (max-width: 720px){
      section{ padding:72px 14px; }
      p{ font-size:16px; }

      /* Navbar: Desktop links aus, Burger an */
      .nav-links{ display:none; }
      .burger{ display:inline-flex; align-items:center; gap:8px; }

      /* HUD Buttons full width-ish */
      .hud{ padding:12px; }
      .hud .right{ justify-content:stretch; }
      .hud .right .btn{ flex: 1 1 110px; }

      /* Arena etwas kleiner */
      .arena{ height: 360px; }

      /* Catcher kleiner */
      .catcher{ width: 138px; height: 78px; }
      .catcher .label{ font-size:12px; }

      /* Items kleiner */
      .fall{ width:32px; height:32px; }

      /* Nico-Hint k√ºrzer */
      #hint{ display:none; }
    }
  </style>
</head>

<body>

  <nav id="nav">
    <div class="nav-inner">
      <a class="logo" href="#top" id="logoLink">üç∫ NicoBierchen</a>

      <div class="nav-links" aria-label="Navigation">
        <a href="#start">Startseite</a>
        <a href="#trink">Trink einen mit mir</a>
        <a href="#spiele">Spiele</a>
        <a href="#traeume">Stadt der Tr√§ume</a>
      </div>

      <button class="burger" id="burgerBtn" aria-label="Men√º √∂ffnen">
        ‚ò∞ Men√º
      </button>
    </div>

    <div class="mobile-menu" id="mobileMenu">
      <div class="mobile-links">
        <a href="#start">Startseite</a>
        <a href="#trink">Trink einen mit mir</a>
        <a href="#spiele">Spiele</a>
        <a href="#traeume">Stadt der Tr√§ume</a>
      </div>
    </div>
  </nav>

  <div id="top"></div>

  <section id="start">
    <div class="hero">
      <div class="card">
        <h1>Hallo üçª</h1>
        <p>Klick auf das Logo oben links und du bist smooth wieder ganz oben.</p>
        <button class="btn" id="prostBtn">Prost! üç∫</button>
      </div>

      <div class="glass" aria-label="Bierglas Animation">
        <div class="foam"></div>
        <div class="beer"></div>
      </div>
    </div>
  </section>

  <section id="trink">
    <h2>Trink einen mit mir üçª (Bier fangen!)</h2>
    <p>
      Nico wirft dir Bier zu. Fang es mit dem Glas. <b>Jeder Fang = +1 Punkt</b>.
      Fake-Bier zieht dir Punkte ab üòà
    </p>

    <div class="mode-row" id="modes">
      <div class="mode active" data-mode="easy">
        <div class="mode-top">ü•Ç Trink-Mode: Gem√ºtlich <span class="badge easy">LEICHT</span></div>
        <div style="color:var(--muted); margin-top:6px;">Langsam ‚Ä¢ entspannt</div>
      </div>
      <div class="mode" data-mode="mid">
        <div class="mode-top">üî• Heute wird es wild <span class="badge mid">MITTEL</span></div>
        <div style="color:var(--muted); margin-top:6px;">Normal ‚Ä¢ bisschen Druck</div>
      </div>
      <div class="mode" data-mode="hard">
        <div class="mode-top">üßä Eiskalt <span class="badge hard">SCHWER</span></div>
        <div style="color:var(--muted); margin-top:6px;">Schneller ‚Ä¢ aber fair</div>
      </div>
    </div>

    <div class="game-wrap">
      <div class="hud">
        <div class="left">
          <div class="pill">Score: <b id="score">0</b></div>
          <div class="pill">Highscore: <b id="highscore">0</b></div>
          <div class="pill">Mode: <b id="modeLabel">LEICHT</b></div>
          <div class="pill">Sound: <b id="soundState">AN</b></div>
        </div>
        <div class="right">
          <button class="btn" id="startBtn">Start</button>
          <button class="btn btn-ghost" id="resetBtn">Reset</button>
          <button class="btn btn-ghost" id="soundBtn">Sound aus</button>
        </div>
      </div>

      <div class="arena" id="arena" aria-label="Bier-Fang-Spiel">
        <div class="nico">
          <div class="nico-fig">
            <div class="nico-avatar" aria-hidden="true"></div>
            <div class="nico-name">
              <div>üë§ Nico</div>
              <small id="nicoMood">wirft Bier‚Ä¶</small>
            </div>
            <div class="nico-throw">
              <span class="nico-arm" id="nicoArm">ü§õ</span>
              <span id="throwLabel">Wurf</span>
            </div>
          </div>
          <div id="hint">Tasten: ‚óÄÔ∏é ‚ñ∂Ô∏é oder Maus/Touch bewegen</div>
        </div>

        <div class="catcher" id="catcher">
          <div class="shine"></div>
          <div class="foamline" id="glassFoam"></div>
          <div class="fill" id="glassFill"></div>
          <div class="label" id="glassLabel">üç∫ 0%</div>
        </div>
      </div>
    </div>
  </section>

  <section id="spiele">
    <h2>Spiele üéÆ</h2>
    <p>Kommt sp√§ter ‚Äì hier bauen wir dann noch mehr Games rein.</p>
    <div class="card"><p style="margin:0;color:var(--muted);">Platzhalter ‚úÖ</p></div>
  </section>

  <section id="traeume">
    <h2>Stadt der Tr√§ume üåô</h2>
    <p>Neon, Night-Drive, Regen-Effekt ‚Äì sp√§ter machen wir hier richtig Film draus.</p>
    <div class="card">
      <p style="margin:0;color:var(--muted);">‚ú® Idee: Parallax + Night City Vibes.</p>
    </div>
  </section>

  <footer>¬© 2026 NicoBierchen üç∫</footer>

  <script>
    // Logo -> Top smooth
    document.getElementById("logoLink").addEventListener("click", (e) => {
      e.preventDefault();
      document.getElementById("top").scrollIntoView({ behavior: "smooth" });
      closeMobileMenu();
    });

    // Burger Men√º
    const nav = document.getElementById("nav");
    const burgerBtn = document.getElementById("burgerBtn");
    const mobileMenu = document.getElementById("mobileMenu");

    function toggleMobileMenu(){
      nav.classList.toggle("mobile-open");
    }
    function closeMobileMenu(){
      nav.classList.remove("mobile-open");
    }
    burgerBtn.addEventListener("click", ()=>{
      toggleMobileMenu();
    });

    // Mobile links: smooth + menu zu
    mobileMenu.addEventListener("click", (e)=>{
      const a = e.target.closest("a");
      if(!a) return;
      e.preventDefault();
      const id = a.getAttribute("href");
      const el = document.querySelector(id);
      if(el) el.scrollIntoView({behavior:"smooth"});
      closeMobileMenu();
    });

    // Funken
    function spark(x,y, count=14){
      for(let i=0;i<count;i++){
        const s = document.createElement("div");
        s.className = "spark";
        s.style.left = (x - 4) + "px";
        s.style.top  = (y - 4) + "px";
        const dx = (Math.random()*220 - 110) + "px";
        const dy = (Math.random()*220 - 140) + "px";
        s.style.setProperty("--dx", dx);
        s.style.setProperty("--dy", dy);
        document.body.appendChild(s);
        setTimeout(()=> s.remove(), 900);
      }
    }
    document.getElementById("prostBtn").addEventListener("click", (e)=> spark(e.clientX, e.clientY, 28));

    // WebAudio Mini-Sounds
    let soundOn = true;
    let audioCtx = null;
    function ensureAudio(){
      if(!audioCtx){
        const AC = window.AudioContext || window.webkitAudioContext;
        audioCtx = new AC();
      }
      if(audioCtx.state === "suspended") audioCtx.resume().catch(()=>{});
    }
    function beep(freq=520, dur=0.06, type="sine", gain=0.06){
      if(!soundOn) return;
      ensureAudio();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      o.stop(audioCtx.currentTime + dur);
    }
    function catchSound(){
      beep(640, 0.05, "triangle", 0.05);
      setTimeout(()=> beep(860, 0.04, "triangle", 0.045), 30);
    }
    function fakeSound(){
      beep(220, 0.08, "sawtooth", 0.05);
    }

    // Game refs
    const arena = document.getElementById("arena");
    const catcher = document.getElementById("catcher");
    const scoreEl = document.getElementById("score");
    const highEl = document.getElementById("highscore");
    const modeLabel = document.getElementById("modeLabel");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");
    const modesWrap = document.getElementById("modes");
    const soundBtn = document.getElementById("soundBtn");
    const soundState = document.getElementById("soundState");

    // Nico anim
    const nicoArm = document.getElementById("nicoArm");
    const nicoMood = document.getElementById("nicoMood");
    const throwLabel = document.getElementById("throwLabel");

    // Glass fill
    const glassFill = document.getElementById("glassFill");
    const glassFoam = document.getElementById("glassFoam");
    const glassLabel = document.getElementById("glassLabel");

    let running = false;
    let score = 0;
    let mode = "easy";

    // Highscore
    const HS_KEY = "nicobierchen_highscore_v3";
    let highscore = parseInt(localStorage.getItem(HS_KEY) || "0", 10);
    if(!Number.isFinite(highscore)) highscore = 0;
    highEl.textContent = highscore;

    // Movement
    let catcherX = 0.5;
    let targetX = 0.5;
    let arenaRect = null;

    // Difficulty
    const settings = {
      easy: { label:"LEICHT", spawnMs: 980, fallSpeed: 0.20, maxOnScreen: 3, fakeChance: 0.10 },
      mid:  { label:"MITTEL", spawnMs: 760, fallSpeed: 0.24, maxOnScreen: 4, fakeChance: 0.14 },
      hard: { label:"SCHWER", spawnMs: 620, fallSpeed: 0.28, maxOnScreen: 4, fakeChance: 0.18 }
    };

    function applyMode(m){
      mode = m;
      modeLabel.textContent = settings[m].label;
      document.querySelectorAll(".mode").forEach(el => el.classList.toggle("active", el.dataset.mode === m));
    }
    modesWrap.addEventListener("click", (e)=>{
      const modeCard = e.target.closest(".mode");
      if(!modeCard) return;
      applyMode(modeCard.dataset.mode);
      const r = modeCard.getBoundingClientRect();
      spark(r.left + r.width/2, r.top + r.height/2, 10);
    });

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
    function updateArenaRect(){ arenaRect = arena.getBoundingClientRect(); }
    window.addEventListener("resize", updateArenaRect);
    updateArenaRect();

    // Keyboard
    const keys = { left:false, right:false };
    document.addEventListener("keydown", (e)=>{
      if(e.key === "ArrowLeft" || e.key === "a") keys.left = true;
      if(e.key === "ArrowRight" || e.key === "d") keys.right = true;
    });
    document.addEventListener("keyup", (e)=>{
      if(e.key === "ArrowLeft" || e.key === "a") keys.left = false;
      if(e.key === "ArrowRight" || e.key === "d") keys.right = false;
    });

    // Mouse/Touch move
    function setTargetFromClientX(clientX){
      if(!arenaRect) updateArenaRect();
      const x = (clientX - arenaRect.left) / arenaRect.width;
      targetX = clamp(x, 0.08, 0.92);
    }
    arena.addEventListener("mousemove", (e)=> setTargetFromClientX(e.clientX));
    arena.addEventListener("touchstart", (e)=>{
      if(e.touches && e.touches[0]) setTargetFromClientX(e.touches[0].clientX);
    }, {passive:true});
    arena.addEventListener("touchmove", (e)=>{
      if(e.touches && e.touches[0]) setTargetFromClientX(e.touches[0].clientX);
    }, {passive:true});

    // Wobble by score
    function updateWobble(){
      let wobbleDeg = 0;
      let wobbleSpeed = 0.55;

      if(score >= 10) { wobbleDeg = 0.6; wobbleSpeed = 0.55; }
      if(score >= 50) { wobbleDeg = 1.4; wobbleSpeed = 0.40; }
      if(score >= 100){ wobbleDeg = 2.6; wobbleSpeed = 0.28; }

      if(wobbleDeg > 0){
        arena.classList.add("wobble");
        arena.style.setProperty("--wobble", wobbleDeg + "deg");
        arena.style.setProperty("--wobbleSpeed", wobbleSpeed + "s");
        nicoMood.textContent = score >= 100 ? "bro du bist komplett weg üòµ‚Äçüí´" : (score >= 50 ? "l√§uft schon wackelig üòÖ" : "leicht angez√ºndet üòè");
      } else {
        arena.classList.remove("wobble");
        arena.style.removeProperty("--wobble");
        arena.style.removeProperty("--wobbleSpeed");
        nicoMood.textContent = "wirft Bier‚Ä¶";
      }
    }

    // Glass fill
    const GLASS_MAX_SCORE = 120;
    function updateGlassFill(){
      const pct = Math.round(Math.min(100, (score / GLASS_MAX_SCORE) * 100));
      const minH = 12, maxH = 62;
      const h = Math.round(minH + (maxH - minH) * (pct / 100));
      glassFill.style.height = h + "px";
      glassFoam.style.bottom = `calc(10px + ${h}px - 8px)`;
      glassLabel.textContent = `üç∫ ${pct}%`;
    }

    // Nico throw
    function nicoThrow(isFake){
      nicoArm.classList.add("throwing");
      throwLabel.textContent = isFake ? "Fake!" : "Bier!";
      setTimeout(()=> {
        nicoArm.classList.remove("throwing");
        throwLabel.textContent = "Wurf";
      }, 260);
    }

    // Spawn vars
    let lastSpawn = 0;
    let lastTime = 0;

    function spawnItem(){
      const el = document.createElement("div");
      const isFake = Math.random() < settings[mode].fakeChance;

      el.className = "fall " + (isFake ? "fake" : "good");
      el.textContent = isFake ? "üß®" : "üç∫";
      el.dataset.fake = isFake ? "1" : "0";
      el.dataset.y = "-50";

      const x = Math.random() * (arena.clientWidth - 44) + 8;
      el.style.left = x + "px";
      arena.appendChild(el);

      nicoThrow(isFake);
      return el;
    }

    function getBox(el){ return el.getBoundingClientRect(); }

    function tick(ts){
      if(!running) return;

      if(!lastTime) lastTime = ts;
      const dt = Math.min(32, ts - lastTime);
      lastTime = ts;

      // Keyboard -> target
      const keySpeed = 0.0019 * dt;
      if(keys.left) targetX = clamp(targetX - keySpeed*1.7, 0.08, 0.92);
      if(keys.right) targetX = clamp(targetX + keySpeed*1.7, 0.08, 0.92);

      // Smooth follow
      catcherX += (targetX - catcherX) * 0.22;
      catcher.style.left = (catcherX * arena.clientWidth) + "px";

      // Spawn scaling with score (soft)
      const baseSpawn = settings[mode].spawnMs;
      const spawnBoost = Math.min(260, score * 1.2);
      const spawnEvery = Math.max(430, baseSpawn - spawnBoost);

      if(ts - lastSpawn > spawnEvery){
        lastSpawn = ts;
        const current = arena.querySelectorAll(".fall").length;
        if(current < settings[mode].maxOnScreen){
          spawnItem();
        }
      }

      // Move + collision
      const items = Array.from(arena.querySelectorAll(".fall"));
      const cBox = getBox(catcher);

      const speed = settings[mode].fallSpeed * dt * (1 + Math.min(0.55, score/220));

      items.forEach(it=>{
        const y = parseFloat(it.dataset.y || "-50") + speed;
        it.dataset.y = String(y);
        it.style.transform = `translateY(${y}px)`;

        const b = getBox(it);
        const hit = !(b.right < cBox.left || b.left > cBox.right || b.bottom < cBox.top || b.top > cBox.bottom);

        if(hit){
          it.remove();
          const isFake = it.dataset.fake === "1";

          if(isFake){
            score = Math.max(0, score - 3);
            scoreEl.textContent = score;
            fakeSound();
            spark((b.left + b.right)/2, (b.top + b.bottom)/2, 16);
          } else {
            score += 1;
            scoreEl.textContent = score;
            catchSound();
            spark((b.left + b.right)/2, (b.top + b.bottom)/2, 10);

            if(score > highscore){
              highscore = score;
              highEl.textContent = highscore;
              localStorage.setItem(HS_KEY, String(highscore));
            }
          }

          updateWobble();
          updateGlassFill();
          return;
        }

        if(y > arena.clientHeight + 80){
          it.remove();
        }
      });

      requestAnimationFrame(tick);
    }

    function startGame(){
      if(running) return;
      running = true;
      lastSpawn = 0;
      lastTime = 0;
      updateArenaRect();
      ensureAudio();
      startBtn.textContent = "L√§uft‚Ä¶";
      startBtn.disabled = true;
      requestAnimationFrame(tick);
    }

    function resetGame(){
      running = false;
      score = 0;
      scoreEl.textContent = score;
      arena.querySelectorAll(".fall").forEach(el=>el.remove());
      updateWobble();
      updateGlassFill();
      startBtn.textContent = "Start";
      startBtn.disabled = false;
      nicoMood.textContent = "wirft Bier‚Ä¶";
      throwLabel.textContent = "Wurf";
    }

    startBtn.addEventListener("click", startGame);
    resetBtn.addEventListener("click", resetGame);

    soundBtn.addEventListener("click", ()=>{
      soundOn = !soundOn;
      soundState.textContent = soundOn ? "AN" : "AUS";
      soundBtn.textContent = soundOn ? "Sound aus" : "Sound an";
      if(soundOn) ensureAudio();
    });

    applyMode("easy");
    updateWobble();
    updateGlassFill();
  </script>
</body>
</html>
