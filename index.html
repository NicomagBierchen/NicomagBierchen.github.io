<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NicoBierchen üç∫</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#0b0b10;
  color:#f6f7ff;
}
nav{
  position:sticky;top:0;z-index:10;
  background:#0b0b10ee;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
nav a{color:#ffcf4a;text-decoration:none;font-weight:900;margin-left:14px}
section{padding:80px 20px;max-width:1100px;margin:auto}
.btn{padding:10px 14px;border-radius:12px;border:none;font-weight:900;cursor:pointer}
.maze-box{
  height:460px;
  background:#000;
  border-radius:20px;
  overflow:hidden;
  position:relative;
}
#maze3d{width:100%;height:100%}
.overlay{
  position:absolute;inset:0;
  display:none;
  place-items:center;
  background:#000c;
}
.chatlog{
  height:300px;
  overflow:auto;
  background:#111;
  padding:12px;
  border-radius:12px;
}
input{padding:10px;border-radius:10px;border:none;width:70%}
</style>
</head>

<body>

<nav>
  <a href="#start">üç∫ NicoBierchen</a>
  <div>
    <a href="#trink">Trink</a>
    <a href="#spiele">Spiele</a>
    <a href="#traeume">Stadt</a>
    <a href="#chatgpt">ChatGPT</a>
  </div>
</nav>

<section id="start">
  <h1>Willkommen üçª</h1>
  <p>Alles l√§uft auf PC & Handy.</p>
</section>

<section id="trink">
  <h2>ü•Ç Trink einen mit mir</h2>
  <p>Minigame kommt gleich wieder rein ‚Äì Fokus jetzt auf Stabilit√§t.</p>
</section>

<section id="spiele">
  <h2>üéÆ 3D-Labyrinth</h2>
  <p>Klick ins Feld ‚Üí Maus sperren ‚Üí umsehen</p>

  <div class="maze-box" id="mazeWrap">
    <canvas id="maze3d"></canvas>
    <div class="overlay" id="mazeOverlay">‚ùå 3D konnte nicht starten</div>
  </div>
</section>

<section id="traeume">
  <h2>üåô Stadt der Tr√§ume ‚Äì Ochtrup</h2>
  <div id="ochtrupMap" style="height:400px;border-radius:20px"></div>
</section>

<section id="chatgpt">
  <h2>ü§ñ ChatGPT</h2>
  <div class="chatlog" id="chatlog"></div><br>
  <input id="chatInput" placeholder="Schreib was‚Ä¶">
  <button class="btn" id="chatSend">Senden</button>
</section>

<script type="module">
/* ================= THREE ================= */
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js";
import { PointerLockControls } from "https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/controls/PointerLockControls.js";

/* ================= 3D GAME ================= */
const canvas = document.getElementById("maze3d");
const wrap = document.getElementById("mazeWrap");
const overlay = document.getElementById("mazeOverlay");

let renderer, scene, camera, controls;

function initMaze(){
  try{
    renderer = new THREE.WebGLRenderer({canvas,antialias:true});
    renderer.setSize(wrap.clientWidth, wrap.clientHeight);

    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050508);

    camera = new THREE.PerspectiveCamera(
      75,
      wrap.clientWidth / wrap.clientHeight,
      0.1,
      100
    );
    camera.position.set(0,1.6,6);

    controls = new PointerLockControls(camera, wrap);
    wrap.onclick = ()=>controls.lock();
    scene.add(controls.getObject());

    scene.add(new THREE.AmbientLight(0xffffff,0.7));
    const light = new THREE.DirectionalLight(0xffffff,0.6);
    light.position.set(5,10,5);
    scene.add(light);

    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(50,50),
      new THREE.MeshStandardMaterial({color:0x222233})
    );
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    const wallGeo = new THREE.BoxGeometry(2,2,2);
    const wallMat = new THREE.MeshStandardMaterial({color:0x444488});
    for(let i=0;i<45;i++){
      const w = new THREE.Mesh(wallGeo, wallMat);
      w.position.set((Math.random()-0.5)*20,1,(Math.random()-0.5)*20);
      scene.add(w);
    }

    function animate(){
      requestAnimationFrame(animate);
      renderer.render(scene,camera);
    }
    animate();

  }catch(e){
    console.error(e);
    overlay.style.display="grid";
  }
}
initMaze();

/* ================= MAP ================= */
const map = L.map("ochtrupMap").setView([52.2095,7.1893],14);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

/* ================= CHAT ================= */
const WORKER_URL = "https://nicomagbierchen.htw52ccr4m.workers.dev";
const chatlog = document.getElementById("chatlog");
const input = document.getElementById("chatInput");

function addMsg(t){
  const d=document.createElement("div");
  d.textContent=t;
  chatlog.appendChild(d);
  chatlog.scrollTop=9999;
}

addMsg("Hey User üëã Wie hei√üt du?");

document.getElementById("chatSend").onclick = async ()=>{
  const v=input.value.trim();
  if(!v)return;
  addMsg("Du: "+v);
  input.value="";
  const r = await fetch(WORKER_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:v})
  });
  const j = await r.json();
  addMsg("ChatGPT: "+j.reply);
};
</script>

</body>
</html>
